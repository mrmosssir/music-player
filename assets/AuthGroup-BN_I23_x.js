import{i as b,k as p,u as g,a as j,r as d,c as h,l as x,m as A,n as E,o as J,j as n,L as N,p as R,I as l,q as f,t as P,e as T}from"./index-BYbEQyub.js";function m(e){return new Promise((a,t)=>{e.oncomplete=e.onsuccess=()=>a(e.result),e.onabort=e.onerror=()=>t(e.error)})}function U(e,a){let t;const r=()=>{if(t)return t;const s=indexedDB.open(e);return s.onupgradeneeded=()=>s.result.createObjectStore(a),t=m(s),t.then(o=>{o.onclose=()=>t=void 0},()=>{}),t};return(s,o)=>r().then(i=>o(i.transaction(a,s).objectStore(a)))}let u;function w(){return u||(u=U("keyval-store","keyval")),u}function D(e,a=w()){return a("readonly",t=>m(t.get(e)))}function G(e,a,t=w()){return t("readwrite",r=>(r.put(a,e),m(r.transaction)))}const C=async()=>{if(!("showDirectoryPicker"in window))return alert("您的瀏覽器不支援此功能，請使用支援 File System Access API 的瀏覽器（如 Chrome、Edge 等）"),[];try{const e=await window.showDirectoryPicker(),a=[];return await k(e,a),await G("local-music-library",a),await I()}catch(e){return console.error("Error saving local folder:",e),[]}},I=async()=>{try{const e=await D("local-music-library");return e?await Promise.all(e.map(async(t,r)=>({name:t.name,image:"",artist:"本地音樂",id:`local-${r}`,type:"local",url:"",method:async()=>{if(await t.queryPermission({mode:"read"})!=="granted"&&await t.requestPermission({mode:"read"})!=="granted")throw new Error("無法獲得檔案存取權限");return await t.getFile()}}))):[]}catch(e){return console.error("Error loading local music from handler:",e),[]}},k=async(e,a)=>{for await(const t of e.values()){if(t.kind==="file"&&t.name.endsWith(".mp3")){a.push(t);continue}t.kind==="directory"&&await k(t,a)}},F=()=>{const e=b();return{query:{get:t=>new URLSearchParams(e.search).get(t)}}},L=async e=>{const t={method:"GET",url:"https://api.spotify.com/v1/me",headers:{Authorization:`Bearer ${e}`}};try{const{data:r}=await p(t);return{country:r.country,name:r.display_name,email:r.email,followers:r.followers.total,href:r.href,id:r.id,image:r.images[0]?.url||"",product:r.product,type:r.type,uri:r.uri}}catch{return null}},O=()=>{const e=g(),{query:a}=F(),t=j(r=>r.auth.user);return d.useEffect(()=>{(async()=>{const s=h.get("token");if(s){e(x(s));const c=await L(s);if(!c)return;e(A(c));return}const o=a.get("code");if(o){const c=await E(o);if(c?.access_token){h.set("token",c.access_token,c.expires_in),localStorage.setItem("refresh_token",c.refresh_token),location.href="/music-player/";return}}const i=await J();i&&e(x(i))})()},[]),{user:t}},v=()=>{const e=t=>{t.stopPropagation(),R()},[a]=d.useState([{name:"個人頁面",link:""},{name:"登出",method:e}]);return n.jsx("div",{className:"w-[120%] absolute top-full right-0 translate-y-2 z-20 text-white bg-primary-200 px-4 py-5 rounded-lg",children:n.jsx("ul",{className:"flex flex-col gap-y-3 text-left font-light",children:a.map(t=>t.link?n.jsx(N,{to:`/music-player/${t.link}`,className:"cursor-pointer",children:t.name},t.name):n.jsx("li",{onClick:t.method,className:"cursor-pointer",children:t.name},t.name))})})},z=e=>n.jsxs("div",{className:"flex",children:[e.icon&&n.jsx(l,{icon:e.icon,alt:e.main,className:"block w-6 h-8 mt-auto mr-2 mb-0.5"}),n.jsxs("div",{children:[e.sub&&n.jsx("small",{className:"hidden text-secondary text-xs tracking-[0.2rem] text-center lg:block",children:e.sub}),e.main&&n.jsx("h2",{className:"text-white text-2xl font-bold lg:text-4xl",children:e.main})]})]}),q="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAOEAAADhCAMAAAAJbSJIAAAAMFBMVEXFxcX////CwsLGxsb7+/vT09PJycn19fXq6urb29ve3t7w8PDOzs7n5+f5+fnt7e30nlkBAAAFHUlEQVR4nO2dC5qqMAyFMTwUBdz/bq+VYYrKKJCkOfXmXwHna5uTpA+KwnEcx3Ecx3Ecx3Ecx3Ecx3Ecx3Ecx3Ecx3EcA2iO9cdIc5PUdO257y+BU39u66b4HplE3fk6VIcnqmNfl1+gksr6+iIucjl3WYukor7+re6Hoe1y1UhNO3zUd+fUFRmKpOa0Tt6dY5ubRCrOG/QFLk1WGmnt/JxzykcjdZ/jyxJDLlOV2l36AtcsJJb9boG3YcR3DuqODIE3ztYKPkDdmwRmpUToUaSaq++AvRgZMWbOpbQW8hdCAm8ZDugoikzREdCJ2okJPBx6azFLNOwoOgcxojJ98JkaTSJxMpklKrCAKhZGI0drTY/wU5lXoJYibannV9NYy4oozNEAkPHTjop+DTDxVGkIgYJNoyQQJtiIW+EMjGAjm649AjGIaqswcEFQKJ2QPlJbqytki6ZXAAZRJ52J2McaUowzAfs+uFzrYhnzaapphiPWdaJWShqxjqa6kTTQ205TVbsfMa6htL0iYOsXpJrQjHSmCkv1QGPtiHqlYcQ21Gj7fcDU8xOEUuNgSltPzexh+HqFlanCBHZ4OLhCV+gK/3OF6vWvucLv98MUOY2pwu/PS/+D2qJU7pYGbOvDFDW+bbON9p3o3oRxn0bfLgZTgSn6pSfrtr56qLHemtHPTK2319SzGvtjQ9qeb39WgS66Cm073nd0U1PzDdJCO3Gzn6TKpl9Zq7ujGWsQhlA3NwWIMwG9zM08Y/tBrR9VWeczv5CSQuuUNKIUTk23ZJ5RKfVhjnkXotfWIlgX2BSCDYbZR+QTcLhb3dKZDUY2M0d4KWItwhHRah/zsrOgKw4wycwjcgEVcgQDQo23CqSiWEJkFAfod2oE1uIFdA1OsCPqFXYNTjCfb8Ez+iX2x5sKLlVbhtqdDcar9ZevhnbZxoBUD35k23t0d304LYs1ELVbnfFaZ/REJJX9niP8Q19moZGo3m8XR/yBvOnjFfsXcI2c8ZuNo7WMP5HQh6yRGrlmFOJTnyTcT+zRlqPUBI2gTVWNUzUna1ERgecgF4GpNBQ38jGqxVLzQA1A31Rrhk6Yz9QEh/WND0GnuG9huhiTXJkxfAizTHLr6cbJKN6UCU6x/2DTRE1xEeEXi3O0ZUqBN4nJRzHhFB1JPlFTBZlI2kQ8zc3KJ1Le8DIRmFJiknuVS6RK4Ej/JtBfJErDSzOBiY4wJHX6Z1I4v1GUmdCPNirnLLeg3oJLcbX5PcpHNbRvOa1A956QmRPOUXVF+zkaUJynpkYR0bOMJH2nNej1pqyV/aKkz9jr5yj5vrXXz1F5SQLACiMapmierj2ikLyleKdlA/I/2oFxiglxx9B+mHwz0lf34IZQfhDRhlD6bhvgEAoPYooHkTczSIZTLC+cEExsoNKZiGBiY9cCfo/Y/SjIOBMQizWWTe73CMUasJx7jlD+DdKdWUKoY4PRYFtGpO0G1Lx4RaadgTtJhf4fiGqGIwKWCGuGIwKWqP+7IxYCzygjR9IAO5pC7Da9g70TBVpWRNgFBlgT8RV2WxHbKwJMv4BOaEaYaU2K16yZMN/qgV+G7IWIvwyZCxHeDQMsR8wg0DBDDXB5H2EV+hkEGmaoySHQsEJNFoGGFWrAq98JRhUMX1iMMMqLLEIpK5jCbd4vw9nSt/72lewXiN6jmdjfq8Hdknlk92ZwJnbIMMRM7JBhiFlUFoHd1UWaP1QKsPsHA5mkNB+Smn9JqV3wskatnQAAAABJRU5ErkJggg==",S=e=>{const a=g(),{user:t}=O(),[r,s]=d.useState(!1),o=async()=>{const y=await C();a(T(y))},i=()=>n.jsx("button",{className:"bg-transparent border border-white/50 px-6 rounded-full text-white h-10 min-w-36 text-center cursor-pointer",onClick:()=>P(),children:"登入"}),c=()=>n.jsxs("div",{className:"h-10 min-w-36 relative",children:[n.jsxs("button",{className:"relative w-full h-full flex justify-between items-center bg-transparent border border-white/50 rounded-full p-1 cursor-pointer",onClick:()=>s(!r),children:[n.jsx("img",{className:"h-full rounded-full mr-3 aspect-square",src:t.image??q,alt:t.name}),n.jsx("p",{className:"text-white",children:t.name}),n.jsx(l,{icon:"triangle",className:"mr-2 ml-3",width:10,height:10,alt:"展開"})]}),r&&n.jsx(v,{})]});return n.jsxs("div",{className:"flex justify-between items-stretch relative",children:[n.jsx("div",{className:"w-20 flex justify-start items-center lg:hidden",children:n.jsx(l,{icon:"logo",className:"w-6.5 h-6.5",alt:"logo"})}),n.jsx(z,{main:e.title,sub:e.subTitle,icon:e.icon}),n.jsxs("div",{className:"hidden items-center gap-x-4 lg:flex",children:[n.jsx("button",{className:"text-white h-10 min-w-36 rounded-full tracking-[0.05rem] bg-linear-to-r from-secondary-100 to-primary-400 cursor-pointer px-6",onClick:()=>o(),children:"讀取本地圖片"}),t.name?c():i()]}),n.jsxs("div",{className:"flex items-center lg:hidden",children:[n.jsx("button",{className:"block w-10 h-full",onClick:()=>a(f("search",!0)),children:n.jsx(l,{icon:"search",alt:"開啟搜尋欄",className:"mx-auto"})}),n.jsx("button",{className:"block w-10 h-full",onClick:()=>a(f("playlist",!0)),children:n.jsx(l,{icon:"menu",alt:"開啟選單",className:"mx-auto"})})]})]})};export{S as A,I as l};
